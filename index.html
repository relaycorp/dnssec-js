<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@relaycorp/dnssec</title><meta name="description" content="Documentation for @relaycorp/dnssec"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/search.js" id="tsd-search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@relaycorp/dnssec</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-content">
<div class="tsd-page-title">
<h2>@relaycorp/dnssec</h2></div>
<div class="tsd-panel tsd-typography"><a id="md:relaycorpdnssec" class="tsd-anchor"></a><h1><a href="#md:relaycorpdnssec"><code>@relaycorp/dnssec</code></a></h1><p><a href="https://www.npmjs.com/package/@relaycorp/dnssec"><img src="https://badge.fury.io/js/@relaycorp%2Fdnssec.svg" alt="npm version"></a></p>
<p>This is a resolver-agnostic DNSSEC verification library for Node.js that allows you to use any transport you want: UDP, DNS-over-TLS (DoT), DNS-over-HTTPS (DoH), etc.</p>
<p>The latest version can be installed from NPM:</p>
<pre><code class="language-shell"><span class="hl-0">npm </span><span class="hl-1">install</span><span class="hl-0"> </span><span class="hl-1">@relaycorp/dnssec</span>
</code><button>Copy</button></pre>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><p>You need to write a thin integration with your preferred resolver, keeping the following in mind:</p>
<ul>
<li>DNS responses MUST include DNSSEC signatures (i.e., <code>RRSIG</code> records).</li>
<li>DNS responses MUST be passed as a <code>Buffer</code> using DNS wire format (as defined in <a href="https://datatracker.ietf.org/doc/html/rfc1035">RFC 1035</a>), or else you&#39;ll have to initialise a <code>Message</code> that contains all the relevant parts of the response (see below).</li>
<li>You SHOULD instruct your resolver not to do DNSSEC validation remotely.</li>
</ul>
<p>For example, this is how you could use <a href="https://www.npmjs.com/package/dohdec">dohdec</a>&#39;s DNS-over-HTTPS resolver with Cloudflare to retrieve <code>A</code> records for a particular domain name:</p>
<pre><code class="language-js"><span class="hl-2">// main.js</span><br/><span class="hl-3">import</span><span class="hl-0"> { </span><span class="hl-4">dnssecLookUp</span><span class="hl-0">, </span><span class="hl-4">Question</span><span class="hl-0">, </span><span class="hl-4">SecurityStatus</span><span class="hl-0"> } </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;@relaycorp/dnssec&#39;</span><span class="hl-0">;</span><br/><span class="hl-3">import</span><span class="hl-0"> { </span><span class="hl-4">DNSoverHTTPS</span><span class="hl-0"> } </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;dohdec&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">doh</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">DNSoverHTTPS</span><span class="hl-0">({ </span><span class="hl-4">url:</span><span class="hl-0"> </span><span class="hl-1">&#39;https://cloudflare-dns.com/dns-query&#39;</span><span class="hl-0"> });</span><br/><br/><span class="hl-5">async</span><span class="hl-0"> </span><span class="hl-5">function</span><span class="hl-0"> </span><span class="hl-7">getARecord</span><span class="hl-0">(</span><span class="hl-4">domain</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-3">return</span><span class="hl-0"> </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-7">dnssecLookUp</span><span class="hl-0">(</span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Question</span><span class="hl-0">(</span><span class="hl-4">domain</span><span class="hl-0">, </span><span class="hl-1">&#39;A&#39;</span><span class="hl-0">), </span><span class="hl-5">async</span><span class="hl-0"> (</span><span class="hl-4">question</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-0">    </span><span class="hl-4">doh</span><span class="hl-0">.</span><span class="hl-7">lookup</span><span class="hl-0">(</span><span class="hl-4">question</span><span class="hl-0">.</span><span class="hl-4">name</span><span class="hl-0">, {</span><br/><span class="hl-0">      </span><span class="hl-4">rrtype:</span><span class="hl-0"> </span><span class="hl-4">question</span><span class="hl-0">.</span><span class="hl-7">getTypeName</span><span class="hl-0">(),</span><br/><span class="hl-0">      </span><span class="hl-4">json:</span><span class="hl-0"> </span><span class="hl-5">false</span><span class="hl-0">, </span><span class="hl-2">// Request DNS message in wire format</span><br/><span class="hl-0">      </span><span class="hl-4">decode:</span><span class="hl-0"> </span><span class="hl-5">false</span><span class="hl-0">, </span><span class="hl-2">// Don&#39;t parse the DNS message</span><br/><span class="hl-0">      </span><span class="hl-4">dnssec:</span><span class="hl-0"> </span><span class="hl-5">true</span><span class="hl-0">, </span><span class="hl-2">// Retrieve RRSIG records</span><br/><span class="hl-0">      </span><span class="hl-4">dnssecCheckingDisabled:</span><span class="hl-0"> </span><span class="hl-5">true</span><span class="hl-0">, </span><span class="hl-2">// Disable server-side DNSSEC validation</span><br/><span class="hl-0">    }),</span><br/><span class="hl-0">  );</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-5">const</span><span class="hl-0"> [</span><span class="hl-6">domainName</span><span class="hl-0">] = </span><span class="hl-4">process</span><span class="hl-0">.</span><span class="hl-4">argv</span><span class="hl-0">.</span><span class="hl-7">slice</span><span class="hl-0">(</span><span class="hl-8">2</span><span class="hl-0">);</span><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">result</span><span class="hl-0"> = </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-7">getARecord</span><span class="hl-0">(</span><span class="hl-4">domainName</span><span class="hl-0">);</span><br/><span class="hl-3">if</span><span class="hl-0"> (</span><span class="hl-4">result</span><span class="hl-0">.</span><span class="hl-4">status</span><span class="hl-0"> === </span><span class="hl-4">SecurityStatus</span><span class="hl-0">.</span><span class="hl-6">SECURE</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">console</span><span class="hl-0">.</span><span class="hl-7">log</span><span class="hl-0">(</span><span class="hl-1">`</span><span class="hl-5">${</span><span class="hl-4">domainName</span><span class="hl-5">}</span><span class="hl-1">/A =`</span><span class="hl-0">, </span><span class="hl-4">result</span><span class="hl-0">.</span><span class="hl-4">result</span><span class="hl-0">);</span><br/><span class="hl-0">} </span><span class="hl-3">else</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">reason</span><span class="hl-0"> = </span><span class="hl-4">result</span><span class="hl-0">.</span><span class="hl-4">reasonChain</span><span class="hl-0">.</span><span class="hl-7">join</span><span class="hl-0">(</span><span class="hl-1">&#39;, &#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-4">console</span><span class="hl-0">.</span><span class="hl-7">error</span><span class="hl-0">(</span><span class="hl-1">`DNSSEC verification for </span><span class="hl-5">${</span><span class="hl-4">domain</span><span class="hl-5">}</span><span class="hl-1">/A failed: </span><span class="hl-5">${</span><span class="hl-4">reason</span><span class="hl-5">}</span><span class="hl-1">`</span><span class="hl-0">);</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<p>And here&#39;s what requesting a valid <code>A</code> record would look like with the script above:</p>
<pre><code><span class="hl-4">$</span><span class="hl-0"> </span><span class="hl-4">node</span><span class="hl-0"> </span><span class="hl-4">main</span><span class="hl-0">.</span><span class="hl-4">js</span><span class="hl-0"> </span><span class="hl-4">example</span><span class="hl-0">.</span><span class="hl-4">com</span><br/><span class="hl-4">example</span><span class="hl-0">.</span><span class="hl-4">com</span><span class="hl-0">/</span><span class="hl-6">A</span><span class="hl-0"> = </span><span class="hl-4">RrSet</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-9">name</span><span class="hl-0">: </span><span class="hl-1">&#39;example.com.&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-9">classId</span><span class="hl-0">: </span><span class="hl-8">1</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-9">type</span><span class="hl-0">: </span><span class="hl-8">1</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-9">ttl</span><span class="hl-0">: </span><span class="hl-8">83076</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-9">records</span><span class="hl-0">: [</span><br/><span class="hl-0">    </span><span class="hl-4">DnsRecord</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">ttl:</span><span class="hl-0"> </span><span class="hl-8">83076</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">name:</span><span class="hl-0"> </span><span class="hl-1">&#39;example.com.&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">typeId:</span><span class="hl-0"> </span><span class="hl-8">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">classId:</span><span class="hl-0"> </span><span class="hl-8">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">dataSerialised:</span><span class="hl-0"> &lt;</span><span class="hl-10">Buffer</span><span class="hl-0"> 5</span><span class="hl-10">d</span><span class="hl-0"> </span><span class="hl-10">b8</span><span class="hl-0"> </span><span class="hl-10">d8</span><span class="hl-0"> </span><span class="hl-8">22</span><span class="hl-0">&gt;,</span><br/><span class="hl-0">      </span><span class="hl-4">dataFields:</span><span class="hl-0"> </span><span class="hl-1">&#39;93.184.216.34&#39;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  ]</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<a id="md:successful-rrset" class="tsd-anchor"></a><h3><a href="#md:successful-rrset">Successful RRset</a></h3><p>When DNSSEC validation succeeds, you get a <code>VerifiedRrSet</code> object with the following properties:</p>
<ul>
<li><code>status</code>: Set to <code>SecurityStatus.SECURE</code>.</li>
<li><code>result</code>: An RRset containing one or more records (<code>DnsRecord</code> instances). Each record exposes its data in both serialised and deserialised forms in the <code>dataSerialised</code> and <code>dataFields</code> properties, respectively. <code>dataFields</code> is an object whose structure is determined by <a href="https://www.npmjs.com/package/dns-packet"><code>dns-packet</code></a>.</li>
</ul>
<a id="md:error-handling" class="tsd-anchor"></a><h3><a href="#md:error-handling">Error handling</a></h3><p>As this is primarily a DNSSEC library, we treat DNS and DNSSEC errors differently:</p>
<ul>
<li>Any input that violates DNS RFCs in ways from which we can&#39;t recover will result in errors.</li>
<li>Any input that violates DNSSEC RFCs will result in one of the three failure <em>security statuses</em> defined in <a href="https://www.rfc-editor.org/rfc/rfc4035#section-4.3">RFC 4035 (Section 4.3)</a>: insecure, bogus or indeterminate.</li>
</ul>
<p>However, errors are thrown upon attempting to parse malformed RDATA values for DNSSEC records -- we use a third-party library that parses the DNS message eagerly.</p>
<a id="md:validation-period" class="tsd-anchor"></a><h3><a href="#md:validation-period">Validation period</a></h3><p>By default, DNSSEC signatures MUST be valid at the time the <code>dnssecLookUp()</code> function is called, but this can be customised by passing a <code>Date</code> or <code>IDatePeriod</code> object.</p>
<p>An <code>IDatePeriod</code> object is useful when you just want signatures to be valid <strong>at any point</strong> within a given time period. For example, if you want to tolerate <a href="https://en.wikipedia.org/wiki/Clock_drift">clock drift</a>, you could accept signatures valid in the past hour:</p>
<pre><code class="language-js"><span class="hl-3">import</span><span class="hl-0"> { </span><span class="hl-4">IDatePeriod</span><span class="hl-0">, </span><span class="hl-4">dnssecLookUp</span><span class="hl-0"> } </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;@relaycorp/dnssec&#39;</span><span class="hl-0">;</span><br/><span class="hl-3">import</span><span class="hl-0"> { </span><span class="hl-4">subHours</span><span class="hl-0"> } </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;date-fns&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">now</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Date</span><span class="hl-0">();</span><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">datePeriod</span><span class="hl-0">: </span><span class="hl-10">IDatePeriod</span><span class="hl-0"> = { </span><span class="hl-4">start:</span><span class="hl-0"> </span><span class="hl-7">subHours</span><span class="hl-0">(</span><span class="hl-4">now</span><span class="hl-0">, </span><span class="hl-8">1</span><span class="hl-0">), </span><span class="hl-4">end:</span><span class="hl-0"> </span><span class="hl-4">now</span><span class="hl-0"> };</span><br/><span class="hl-7">dnssecLookUp</span><span class="hl-0">(</span><span class="hl-6">QUESTION</span><span class="hl-0">, </span><span class="hl-6">RESOLVER</span><span class="hl-0">, { </span><span class="hl-4">dateOrPeriod:</span><span class="hl-0"> </span><span class="hl-4">datePeriod</span><span class="hl-0"> });</span>
</code><button>Copy</button></pre>
<a id="md:custom-trust-anchors" class="tsd-anchor"></a><h3><a href="#md:custom-trust-anchors">Custom trust anchors</a></h3><p>By default, the root <code>DNSKEY</code>(s) are verified against a local copy of <a href="https://www.iana.org/dnssec/files">IANA&#39;s trust anchors</a>. This can be customised with the <code>trustAnchors</code> option; e.g.:</p>
<pre><code class="language-js"><span class="hl-3">import</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">dnssecLookUp</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">DnssecAlgorithm</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">DigestType</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">TrustAnchor</span><span class="hl-0">,</span><br/><span class="hl-0">} </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;@relaycorp/dnssec&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">customTrustAnchor</span><span class="hl-0">: </span><span class="hl-10">TrustAnchor</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-4">algorithm:</span><span class="hl-0"> </span><span class="hl-4">DnssecAlgorithm</span><span class="hl-0">.</span><span class="hl-6">RSASHA256</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">digest:</span><span class="hl-0"> </span><span class="hl-4">Buffer</span><span class="hl-0">.</span><span class="hl-7">from</span><span class="hl-0">(</span><span class="hl-1">&#39;the digest&#39;</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">digestType:</span><span class="hl-0"> </span><span class="hl-4">DigestType</span><span class="hl-0">.</span><span class="hl-6">SHA256</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">keyTag:</span><span class="hl-0"> </span><span class="hl-8">42</span><span class="hl-0">,</span><br/><span class="hl-0">};</span><br/><span class="hl-7">dnssecLookUp</span><span class="hl-0">(</span><span class="hl-6">QUESTION</span><span class="hl-0">, </span><span class="hl-6">RESOLVER</span><span class="hl-0">, { </span><span class="hl-4">trustAnchors:</span><span class="hl-0"> [</span><span class="hl-4">customTrustAnchor</span><span class="hl-0">] });</span>
</code><button>Copy</button></pre>
<a id="md:responses-parsed-eagerly" class="tsd-anchor"></a><h3><a href="#md:responses-parsed-eagerly">Responses parsed eagerly</a></h3><p>If your DNS lookup library parses responses eagerly and doesn&#39;t give you access to the original response in wire format, you will have to convert their messages to <code>Message</code> instances. Refer to our API docs to learn how to initialise <code>Message</code>s.</p>
<a id="md:testing" class="tsd-anchor"></a><h2><a href="#md:testing">Testing</a></h2><p>To facilitate the simulation of the various outcomes of DNSSEC validation, we provide the <code>MockChain</code> utility so that you can pass a custom resolver and trust anchor to <code>dnssecLookUp()</code>. This is particularly useful in unit tests where you aren&#39;t able to mock this module (e.g., Jest doesn&#39;t support mocking our ESM as of this writing).</p>
<p>The following example shows how to generate a verified RRset:</p>
<pre><code class="language-javascript"><span class="hl-3">import</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">dnssecLookUp</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">DnsRecord</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">MockChain</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">RrSet</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">SecurityStatus</span><span class="hl-0">,</span><br/><span class="hl-0">} </span><span class="hl-3">from</span><span class="hl-0"> </span><span class="hl-1">&#39;@relaycorp/dnssec&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">RECORD</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">DnsRecord</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-1">`example.com.`</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">&#39;TXT&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">DnsClass</span><span class="hl-0">.</span><span class="hl-6">IN</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-8">42</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">&#39;The data&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">);</span><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">QUESTION</span><span class="hl-0"> = </span><span class="hl-6">RECORD</span><span class="hl-0">.</span><span class="hl-7">makeQuestion</span><span class="hl-0">();</span><br/><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">RRSET</span><span class="hl-0"> = </span><span class="hl-4">RrSet</span><span class="hl-0">.</span><span class="hl-7">init</span><span class="hl-0">(</span><span class="hl-6">QUESTION</span><span class="hl-0">, [</span><span class="hl-6">RECORD</span><span class="hl-0">]);</span><br/><br/><span class="hl-7">test</span><span class="hl-0">(</span><span class="hl-1">&#39;Generating a SECURE result&#39;</span><span class="hl-0">, </span><span class="hl-5">async</span><span class="hl-0"> () </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">mockChain</span><span class="hl-0"> = </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-4">MockChain</span><span class="hl-0">.</span><span class="hl-7">generate</span><span class="hl-0">(</span><span class="hl-6">RECORD</span><span class="hl-0">.</span><span class="hl-4">name</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-5">const</span><span class="hl-0"> { </span><span class="hl-6">resolver</span><span class="hl-0">, </span><span class="hl-6">trustAnchors</span><span class="hl-0"> } = </span><span class="hl-4">mockChain</span><span class="hl-0">.</span><span class="hl-7">generateFixture</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-6">RRSET</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">SecurityStatus</span><span class="hl-0">.</span><span class="hl-6">SECURE</span><span class="hl-0">,</span><br/><span class="hl-0">  );</span><br/><br/><span class="hl-0">  </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">result</span><span class="hl-0"> = </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-7">dnssecLookUp</span><span class="hl-0">(</span><span class="hl-6">QUESTION</span><span class="hl-0">, </span><span class="hl-4">resolver</span><span class="hl-0">, { </span><span class="hl-4">trustAnchors</span><span class="hl-0"> });</span><br/><span class="hl-0">  </span><span class="hl-7">expect</span><span class="hl-0">(</span><span class="hl-4">result</span><span class="hl-0">).</span><span class="hl-7">toStrictEqual</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-4">status:</span><span class="hl-0"> </span><span class="hl-4">SecurityStatus</span><span class="hl-0">.</span><span class="hl-6">SECURE</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">result:</span><span class="hl-0"> </span><span class="hl-6">RRSET</span><span class="hl-0">,</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<a id="md:api-documentation" class="tsd-anchor"></a><h2><a href="#md:api-documentation">API documentation</a></h2><p>The API documentation is available on <a href="https://docs.relaycorp.tech/dnssec-js/">docs.relaycorp.tech</a>.</p>
<a id="md:missing-functionality" class="tsd-anchor"></a><h2><a href="#md:missing-functionality">Missing functionality</a></h2><p>This library implements all the relevant RFCs defining DNSSEC, except for the following functionality that we didn&#39;t need, but for which you&#39;re welcome to propose PRs:</p>
<ul>
<li><a href="https://github.com/relaycorp/dnssec-js/issues/17">Denial of existence</a> (<code>NSEC</code> and <code>NSEC3</code> records).</li>
<li>DSA (DNSSEC algorithm <code>3</code>) because <a href="https://github.com/relaycorp/dnssec-js/issues/50">it&#39;s too insecure and hardly used</a>.</li>
</ul>
<p>The following <a href="https://www.iana.org/assignments/dns-sec-alg-numbers/dns-sec-alg-numbers.xhtml#dns-sec-alg-numbers-1">DNSSEC algorithms</a> are unsupported, and we probably won&#39;t accept PRs for them:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/GOST">GOST</a> (<code>12</code>) due to lack of support in Node.js, and its lack of popularity and security doesn&#39;t seem to justify integrating a third party NPM package supporting it (assuming a suitable one exists).</li>
<li><a href="https://www.rfc-editor.org/rfc/rfc4034.html#appendix-A.1.1">Private algorithms</a> (<code>253</code> and <code>254</code>).</li>
</ul>
<a id="md:alternatives-considered" class="tsd-anchor"></a><h2><a href="#md:alternatives-considered">Alternatives considered</a></h2><p>As surprising as it may sound, there&#39;s no (reliable) way to do DNSSEC verification in Node.js in 2022, so when you see a JS app or library that claims DNSSEC support, <a href="https://stackoverflow.com/a/38339760/129437">chances are they&#39;re just blindly trusting a resolver like Cloudflare or Google</a> -- which, admittedly, is sufficient in many cases and even desirable for performance reasons.</p>
<p><a href="https://github.com/nodejs/node/issues/14475">The Node.js team considered adding DNSSEC support</a> but ruled it out due to <a href="https://github.com/c-ares/c-ares/pull/20">lack of support in their upstream DNS library</a>. As a consequence, two libraries have tried to fill the vacuum:</p>
<ul>
<li><a href="https://github.com/getdnsapi/getdns-node">getdns-node</a>. Unfortunately, it was last updated in June 2021 and its dependency on an externally-managed C library has proven extremely problematic (see <a href="https://github.com/getdnsapi/getdns-node/issues/8">#8</a>, <a href="https://github.com/getdnsapi/getdns-node/issues/33">#33</a>, <a href="https://github.com/getdnsapi/getdns-node/issues/38">#38</a>, <a href="https://github.com/getdnsapi/getdns-node/issues/42">#42</a>, etc).</li>
<li><a href="https://github.com/netkicorp/dnssecjs">dnssecjs</a>. Unfortunately, it was abandoned shortly after it was (apparently) completed in 2017 and it was never published to NPM (so it&#39;s unlikely it was ever used). We decided not to fork it because we won&#39;t know how reliable/secure it is (assuming it works) until we spend significant time reviewing the code and testing it, and then we&#39;d have to spend a lot more time to (1) rewrite it to match the tech and best practices available in 2022 (e.g., TypeScript) and (2) thoroughly unit test it (and it doesn&#39;t have a single test).</li>
</ul>
<a id="md:nodejs-version-support" class="tsd-anchor"></a><h2><a href="#md:nodejs-version-support">Node.js version support</a></h2><p>This library requires Node.js 16 or newer, but going forward we will follow the Node.js release schedule.</p>
<a id="md:contributions" class="tsd-anchor"></a><h2><a href="#md:contributions">Contributions</a></h2><p>We love contributions! If you haven&#39;t contributed to a Relaycorp project before, please take a minute to <a href="https://github.com/relaycorp/.github/blob/master/CONTRIBUTING.md">read our guidelines</a> first.</p>
</div></div>
<div class="col-sidebar">
<div class="page-menu">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg>Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg>On This Page</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li>
<ul>
<li><a href="#md:relaycorpdnssec"><span>@relaycorp/dnssec</span></a></li>
<li>
<ul>
<li><a href="#md:usage"><span>Usage</span></a></li>
<li>
<ul>
<li><a href="#md:successful-rrset"><span>Successful RRset</span></a></li>
<li><a href="#md:error-handling"><span>Error handling</span></a></li>
<li><a href="#md:validation-period"><span>Validation period</span></a></li>
<li><a href="#md:custom-trust-anchors"><span>Custom trust anchors</span></a></li>
<li><a href="#md:responses-parsed-eagerly"><span>Responses parsed eagerly</span></a></li></ul></li>
<li><a href="#md:testing"><span>Testing</span></a></li>
<li><a href="#md:api-documentation"><span>API documentation</span></a></li>
<li><a href="#md:missing-functionality"><span>Missing functionality</span></a></li>
<li><a href="#md:alternatives-considered"><span>Alternatives considered</span></a></li>
<li><a href="#md:nodejs-version-support"><span>Node.js version support</span></a></li>
<li><a href="#md:contributions"><span>Contributions</span></a></li></ul></li></ul></li></ul></div></details></div>
<div class="site-menu">
<nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-namespace)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4-path"></rect><path d="M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z" fill="var(--color-text)" id="icon-4-text"></path></svg><span>@relaycorp/dnssec</span></a>
<ul class="tsd-small-nested-navigation">
<li><a href="enums/DigestType.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-enum)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-8-path"></rect><path d="M9.45 16V7.24H14.49V8.224H10.518V10.936H14.07V11.908H10.518V15.016H14.49V16H9.45Z" fill="var(--color-text)" id="icon-8-text"></path></svg><span>Digest<wbr/>Type</span></a></li>
<li><a href="enums/DnsClass.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-8-path"></use><use href="#icon-8-text"></use></svg><span>Dns<wbr/>Class</span></a></li>
<li><a href="enums/DnssecAlgorithm.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-8-path"></use><use href="#icon-8-text"></use></svg><span>Dnssec<wbr/>Algorithm</span></a></li>
<li><a href="enums/SecurityStatus.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-8-path"></use><use href="#icon-8-text"></use></svg><span>Security<wbr/>Status</span></a></li>
<li><a href="classes/DnsRecord.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-class)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-128-path"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)" id="icon-128-text"></path></svg><span>Dns<wbr/>Record</span></a></li>
<li><a href="classes/Message.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg><span>Message</span></a></li>
<li><a href="classes/MockChain.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg><span>Mock<wbr/>Chain</span></a></li>
<li><a href="classes/Question.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg><span>Question</span></a></li>
<li><a href="classes/RrSet.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg><span>Rr<wbr/>Set</span></a></li>
<li><a href="interfaces/FailureResult.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-256-path"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)" id="icon-256-text"></path></svg><span>Failure<wbr/>Result</span></a></li>
<li><a href="interfaces/Header.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg><span>Header</span></a></li>
<li><a href="interfaces/IDatePeriod.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg><span>IDate<wbr/>Period</span></a></li>
<li><a href="interfaces/MockChainFixture.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg><span>Mock<wbr/>Chain<wbr/>Fixture</span></a></li>
<li><a href="interfaces/TrustAnchor.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg><span>Trust<wbr/>Anchor</span></a></li>
<li><a href="interfaces/VerificationOptions.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg><span>Verification<wbr/>Options</span></a></li>
<li><a href="types/ChainVerificationResult.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-type-alias)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4194304-path"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)" id="icon-4194304-text"></path></svg><span>Chain<wbr/>Verification<wbr/>Result</span></a></li>
<li><a href="types/DnsClassIdOrName.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Dns<wbr/>Class<wbr/>Id<wbr/>Or<wbr/>Name</span></a></li>
<li><a href="types/DnsClassName.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Dns<wbr/>Class<wbr/>Name</span></a></li>
<li><a href="types/FailureStatus.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Failure<wbr/>Status</span></a></li>
<li><a href="types/IanaRrTypeIdOrName.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Iana<wbr/>Rr<wbr/>Type<wbr/>Id<wbr/>Or<wbr/>Name</span></a></li>
<li><a href="types/IanaRrTypeName.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Iana<wbr/>Rr<wbr/>Type<wbr/>Name</span></a></li>
<li><a href="types/Resolver.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Resolver</span></a></li>
<li><a href="types/VerifiedRrSet.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg><span>Verified<wbr/>Rr<wbr/>Set</span></a></li>
<li><a href="functions/dnssecLookUp.html"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg><span>dnssec<wbr/>Look<wbr/>Up</span></a></li></ul></nav></div></div></div>
<div class="tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div></body></html>